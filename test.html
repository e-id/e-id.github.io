<html>
  <head>
    <title>e-ID Test</title>
    <script type="text/javascript">

      // setter (hidden window)
      window.addEventListener('load', function() {
        var result = decodeURIComponent(new String(location.hash).substring(1));
        if (result !== '') {
          window.localStorage.setItem('e-id-data', result);
          var url = new URL(location.href);
          if (url.searchParams.has('e-id-hidden') && url.searchParams.get('e-id-hidden') === '1') {
            setTimeout(function() {
              window.close();
            }, 1000);
          } else {
            var pretty = JSON.stringify(JSON.parse(result), null, ' ');
            document.getElementById('result').value = pretty;
          }
        } else {
          // init
          window.localStorage.setItem('e-id-data', null);
        }
      });

      // getter (caller - localStorage)
      window.addEventListener('storage', function(event) {
        if (event.key === 'e-id-data') {
          var pretty = JSON.stringify(JSON.parse(event.newValue), null, ' ');
          document.getElementById('result').value = pretty;
        }
      });
  
    </script>
  </head>
  <body>
    <a href="e-id://e-id.github.io/test.html?e-id-hidden=1#">Click here to test (using hidden window & localStorage)</a><hr />
    <textarea id="result" style="width: 100%; height: 50%;"></textarea>
  </body>
</html>
